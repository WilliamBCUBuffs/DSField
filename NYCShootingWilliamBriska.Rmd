---
title: "NYC Shooting Incident Analysis"
author: "William Briska"
date: "2024-10-11"
output:
  pdf_document: default
  html_document: default
---
```{r setup, include=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
#suppressing warnings about package versions
```

# Analysis of NYC Shootings by Month (2006-2023)
## Introduction


The purpose of this analysis is to examine NYC shootings from 2006-2023 on the basis of monthly trends and patterns.


## Importing and Cleaning Data


### Load Packages
```{r}
library(dplyr) # I am unsure if this was used in class, please install if not. 
# Run: install.packages("dplyr") in console if not.

library(lubridate)
library(tidyverse)
```
### Read CSV

```{r}
##Reading in the data from the provided website using a URL to a csv link ##IMPORT 
url <- "https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"
data <- read.csv(url)
```
### Cleaning the Data
```{r}
#check for missing values
colSums(is.na(data))
#Only NAs in columns I am not concerned with for my analysis, 
#dropping columns I will not be using. #TIDYING
data_clean <- data %>% 
  select(OCCUR_DATE,OCCUR_TIME)
#determine datatypes in dataframe
sapply(data_clean, typeof)
#set dates to datetime
data_clean <- data_clean %>%
  mutate(
    OCCUR_DATE = mdy(OCCUR_DATE), OCCUR_TIME = hms(OCCUR_TIME)
    )
#look at a summary for any potential outliers and to get a better understanding of data
summary(data_clean)
```
## Shootings by Month
```{r month, out.width="100%", fig.align="center"}
#Getting the month from OCCUR_DATE, counting each occurrence, plotting bar chart. 
#TRANSFORMING and VISUALIZING
data_clean %>%
  mutate(month = month(OCCUR_DATE, label = TRUE)) %>%
  count(month)%>%
  ggplot(aes(x=month,y = n)) +
  geom_bar(stat = "identity",position = "dodge",fill="black") +
  labs(title = "Total NYC Shootings By Month", x = "Month", y = "Number of Shootings")

```
Observing the total shootings from 2006-2023 by month shows a clear seasonal pattern. There is an increase from the Winter month lows, peaking in the mid-Summer month of July before tapering off into the Fall. This potentially suggests that environmental or socio-economic factors related to seasons may influence the number of shootings in NYC from 2006-2023.

```{r Max across years, out.width="100%", fig.align="center"}
#plotting the maximum and minimum number of shootings by month across all years
data_clean %>%
  mutate(year = year(OCCUR_DATE),month = month(OCCUR_DATE, label = TRUE))%>%
  
  count(year, month) %>%
  group_by(month) %>%
  summarize(max_shootings = max(n),
            min_shootings = min(n)) %>%
  pivot_longer(cols = c(max_shootings, min_shootings), 
               names_to = "metric", values_to = "shootings") %>%
  ggplot(aes(x=month, y=shootings, fill = metric) )+
  geom_bar(stat = "identity", position = "dodge") + 
  scale_fill_manual(values = c("max_shootings" = "black", "min_shootings" = "yellow"))+
  labs(title = "Maximum and Minimum NYC Shootings by Month (2006-2023)", 
       x = "Month", y = "Number of Shootings", fill = "Metric")

```
<br><br>

The maximum and minimum number of shootings in NYC from 2006-2023 follow the same general pattern as total shootings by month across 2006-2023. This suggests a strong seasonal effect that is present across years despite year over year changes to potential influencing factors such as: political leadership and the resulting policies, crime rates, and economic conditions or social conditions such as gang activity. The listed potential influencing factors are just conjecture. 


```{r mean and median, out.width="100%", fig.align="center"}
data_clean %>%
  mutate(year = year(OCCUR_DATE), month = month(OCCUR_DATE, label = TRUE)) %>%
  count(year, month) %>%
  group_by(month) %>%
  summarize(mean_shootings = mean(n),median_shootings = median(n)) %>%
  pivot_longer(cols = c(mean_shootings, median_shootings),
               names_to = "metric", values_to = "shootings") %>%
  ggplot(aes(x=month, y=shootings, fill = metric) ) +
  geom_bar(stat = "identity", position = "dodge") + 
  scale_fill_manual(values = c("mean_shootings" = "black", "median_shootings" = "yellow"))+
  labs(title = "Average and Median NYC Shootings by Month (2006-2023)", 
       x = "Month", y = "Number of Shootings", fill = "Metric")
  
```
The closeness of the mean and median of shootings by month across 2006-2023 suggests there are few outliers affecting the average for each month. This suggests the seasonal trends are stable and not skewed by extreme events in specific years.

## Linear Regression Model



```{r linear model, out.width="100%", fig.align="center"}
# creating a linear regression model for monthly shootings and predicting shooting for each month
#linear regression model
shooting_model_data <- data_clean %>%
    mutate(month = month(OCCUR_DATE),year = year(OCCUR_DATE)) %>%
  count(year, month) %>%
  mutate(month = as.factor(month))
shooting_model <- lm(n ~ month, data = shooting_model_data)
ggplot(shooting_model_data, aes(x=month, y = n)) +
  geom_boxplot() + 
  geom_smooth(method = "lm", se = FALSE, color = "yellow") +
  labs(title = "Linear Model of Shootings By Month",
       x = "Month", y = "Number of Shootings")

```

```{r summary}
#summary of linear model

summary(shooting_model)
```
The linear regression model provides statistical evidence for the previously observed seasonal patterns.


1. Per the summary, May through September show a statistically significant increase in shootings relative to January, denoted by the ***. 


2. The peak of shootings in July was confirmed, there are about 88 more shootings in July compared to January.


3. The coefficients gradually increase from May to July then gradually decrease from August to December, this mirrors the consistent pattern showed through previous visualizations.


4. An R-squared value of .4045 states that 40.45% of variability in number of shootings is explained by month. 60.55% is unexplained.


5. A p-value of 2.2e-16 is extremely low, meaning the model is statistically significant.

## Predictions

```{r forecast model, out.width="100%", fig.align="center"}
#predictions model
forecast <- data.frame(month = factor(1:12))
forecast$forecasted_shootings <-predict(shooting_model, newdata = forecast)
ggplot(forecast, aes(x=month, y = forecasted_shootings))+
geom_bar(stat="identity",fill="black")+
  labs(title = "Predicted Number of Shootings by Month",
       x= "Month", y = "Predicted Shootings")
```
<br>

<br>
<br>

The prediction model visualizes the expected number of shootings per month based on the linear regression. The prediction clearly mimics the pattern demonstrated repeatedly above.

## Conclusion

A clear seasonal pattern is observed when considering different metrics of shootings in NYC for the years 2006-2023. Shootings consistently peak in the summer months and reach their lowest in the winter months, in particular July and February respectively. The increase in shootings is statistically significant for the summer months relative to January. There exists a consistency across years, the pattern is strong, appearing in totals, maximum and minimum, average and median.There was no causation shown, however potential variables associated with seasons such as precipitation levels, temperatures, patterns of social activities may potentially influence the number of shootings.

## Limitations
- The analysis does not focus on any long term trends or how specific major events may have influenced the number of shootings per month. 
- Further analysis should explore precipitation rates, temperature, economic and social health and/or policy.
- The dataset is missing the last two days of 2023, though likely there is minimal impact on the analysis.

### Personal Bias

There was a prior expectation that shootings in NYC for 2006-2023 would be higher in the summer months and lower in the winter months, however I did not expect the clear increase, peak and decrease. I also wanted to see a clear pattern emerge in the visualizations. Mitigation of this bias was made by relying on statistical evidence and repeated demonstration that the pattern exists. I also tried to view it from the opposite perspective, considering arguments for why winter months may have more shootings, perhaps due to extended time inside with family leading to more domestic violence etc. 

# Session Info
```{r}
sessionInfo()
```
